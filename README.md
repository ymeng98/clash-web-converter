# 🌐 Clash稳定中转SOCKS代理转换器 - Web版

一个现代化的Web界面，用于将机场订阅链接或配置文件转换为稳定的多地区SOCKS代理配置。

## 🌐 OpenWrt软路由支持

### 🚀 一键部署SOCKS多出口
本项目现已支持OpenWrt软路由，提供专业级的SOCKS多出口功能：

#### ✨ 主要特性
- **6个代理端口**：7890混合代理 + 5个地区专线SOCKS
- **智能分流**：自动识别并选择最佳线路
- **透明代理**：局域网设备自动走代理，无需单独配置
- **Web管理**：可视化管理界面，实时监控流量
- **一键部署**：提供自动化部署脚本

#### 🎯 端口分配
- **7890**: 混合代理（HTTP+SOCKS）- 智能选择所有节点
- **7891**: 🇭🇰 香港专线SOCKS - 适合办公、聊天应用
- **7892**: 🇺🇸 美国专线SOCKS - 适合流媒体解锁
- **7893**: 🇯🇵 日本专线SOCKS - 适合游戏加速
- **7894**: 🇸🇬 新加坡专线SOCKS - 备用线路
- **7895**: 🇹🇼 台湾专线SOCKS - 备用线路

#### 📖 部署指南
- **详细指南**: [OpenWrt部署指南](OPENWRT_DEPLOYMENT_GUIDE.md)
- **快速开始**: [快速开始指南](OPENWRT_QUICK_START.md)
- **一键脚本**: `deploy-openwrt.sh`

## ✨ 特性亮点

### 🎯 核心功能
- ✅ **订阅链接转换** - 支持从任意机场订阅链接直接转换
- ✅ **文件上传转换** - 支持拖拽上传.yaml/.yml/.txt配置文件  
- ✅ **智能节点过滤** - 自动提取稳定中转节点，排除不稳定直连
- ✅ **地区专线分组** - 为香港、美国、日本、新加坡、台湾生成专用SOCKS端口
- ✅ **实时进度显示** - 转换过程可视化进度条
- ✅ **一键下载配置** - 生成的配置文件可直接下载

### 🎨 用户体验
- 🌙 **现代暗色主题** - 护眼暗色界面设计
- 📱 **响应式设计** - 完美适配桌面和移动设备
- 🚀 **流畅动画效果** - 丰富的交互动画和过渡效果
- 💡 **直观操作指引** - 清晰的使用说明和错误提示
- 📊 **详细统计展示** - 节点数量、地区分布等详细信息

## 🚀 快速开始

### 方法1：一键启动（推荐）
```bash
# Windows用户
双击运行：start.bat

# 自动完成依赖安装和服务启动
# 浏览器访问：http://localhost:5000
```

### 方法2：手动启动
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 启动服务
python app.py

# 3. 访问Web界面
# http://localhost:5000
```

## 📖 使用方法

### 🔗 订阅链接转换
1. 选择"订阅链接"标签页
2. 粘贴机场提供的订阅链接
3. 点击"开始转换"
4. **选择获取方式**：
   - **📋 复制订阅链接**（推荐）：直接复制到Clash客户端，自动更新
   - **💾 下载配置文件**：手动下载配置文件导入

### 📁 文件上传转换  
1. 选择"上传文件"标签页
2. 拖拽或点击上传配置文件
3. 支持.yaml、.yml、.txt格式
4. 点击"开始转换"并下载/复制结果

### 📱 订阅链接使用指南

#### 🖥️ 本机使用
- 直接复制订阅链接导入到Clash等客户端
- 支持自动更新配置

#### 📱 移动设备使用
- **同一WiFi网络**：确保手机和电脑在同一局域网
- **使用局域网IP**：启动时会显示局域网地址，如 `http://192.168.1.100:5000`
- **防火墙设置**：确保5000端口可访问
- **操作步骤**：
  1. 复制订阅链接
  2. 在手机Clash中添加配置
  3. 粘贴订阅链接并更新

#### ⚠️ 重要提示
- **网络要求**：移动设备需要与电脑在同一局域网内
- **端口访问**：确保Windows防火墙允许5000端口
- **IP地址**：使用启动时显示的局域网IP而非localhost

## 🔌 端口配置说明

转换后的配置文件将提供以下SOCKS代理端口：

| 端口 | 类型 | 功能 | 推荐用途 |
|------|------|------|----------|
| **7890** | MIXED | 🌟 主端口（智能选择） | **首选**：浏览器、通用应用 |
| **7891** | SOCKS | 🇭🇰 香港专线 | **最快**：日常浏览、视频流媒体 |
| **7892** | SOCKS | 🇺🇸 美国专线 | **解锁**：Netflix、ChatGPT |
| **7893** | SOCKS | 🇯🇵 日本专线 | **游戏**：低延迟、动漫内容 |
| **7894** | SOCKS | 🇸🇬 新加坡专线 | **东南亚**：区域应用 |
| **7895** | SOCKS | 🇹🇼 台湾专线 | **中文**：台湾内容访问 |

## 🎯 使用场景

### 🌐 浏览器代理设置
```
HTTP/HTTPS代理: 127.0.0.1:7890
推荐：通用浏览，自动优选节点
```

### 🎮 游戏加速
```
SOCKS代理: 127.0.0.1:7893 (日本专线)
推荐：日本服务器游戏，低延迟
```

### 📺 流媒体解锁
```
SOCKS代理: 127.0.0.1:7892 (美国专线)  
推荐：Netflix、Hulu等美国内容
```

### 💼 专业应用
```
开发工具: 127.0.0.1:7892 (GitHub访问)
通讯软件: 127.0.0.1:7891 (Telegram等)
```

## 🔧 技术架构

### 后端技术栈
- **Flask 2.3.3** - 轻量级Web框架
- **PyYAML 6.0.1** - YAML配置文件解析
- **Requests 2.31.0** - HTTP请求处理
- **Python 3.7+** - 运行环境

### 前端技术栈
- **HTML5 + CSS3** - 现代Web标准
- **JavaScript ES6+** - 原生JavaScript
- **Font Awesome 6.0** - 图标库
- **CSS Grid + Flexbox** - 响应式布局

### 核心特性
- 🔒 **智能过滤算法** - 自动识别稳定中转节点
- 🌍 **地区智能识别** - 支持emoji和文字双重识别
- 📡 **多格式支持** - 兼容各种订阅和配置格式
- 🛡️ **安全文件处理** - 安全的文件上传和处理机制

## ⚙️ 高级配置

### 自定义过滤条件
编辑`converter.py`中的`is_stable_transit_node`函数：
```python
def is_stable_transit_node(proxy):
    # 自定义过滤逻辑
    name = proxy.get('name', '').lower()
    
    # 只保留中转节点
    if "中转" not in name:
        return False
        
    # 排除IPv6节点
    if "ipv6" in name:
        return False
        
    return True
```

### 端口自定义
修改`converter.py`中的端口分配：
```python
# 自定义起始端口
port = 8000  # 从8000开始

# 自定义地区优先级
priority_regions = ['香港', '日本', '美国']
```

## 🌟 项目优势

### 🎯 相比命令行版本
- ✅ **零技术门槛** - 可视化操作，无需命令行
- ✅ **实时反馈** - 进度显示和错误提示
- ✅ **移动友好** - 支持手机和平板设备
- ✅ **批量处理** - 可同时处理多个配置

### 🚀 相比其他工具
- ✅ **专注稳定性** - 智能过滤不稳定节点
- ✅ **地区专线** - 按地区分配专用端口
- ✅ **现代界面** - 美观易用的Web界面
- ✅ **开源免费** - 完全开源，无广告无限制

## 🐛 故障排除

### 常见问题

#### 1. 订阅链接502错误（Bad Gateway）
```
❌ 502 Bad Gateway - 代理服务器无法访问

解决方案：
• 确保使用正确的IP地址（局域网IP而非localhost）
• 检查设备是否在同一WiFi网络内
• 确认防火墙允许5000端口访问
• 使用启动时显示的局域网地址
```

#### 2. 订阅链接404错误
```
❌ 404错误 - 链接不存在或已过期

解决方案：
• 联系机场客服获取最新链接
• 检查链接是否复制完整
• 确认机场账户状态
```

#### 3. 未找到稳定节点
```
❌ 未找到稳定的中转节点

解决方案：
• 确认配置文件包含有效节点
• 检查节点名称是否包含地区标识
• 联系机场确认中转节点可用性
```

#### 4. 文件上传失败
```
❌ 文件上传失败

解决方案：
• 确认文件格式为.yaml/.yml/.txt
• 检查文件大小是否超过16MB
• 尝试重新下载原始配置文件
```

#### 5. 端口占用问题
```
❌ 端口5000被占用

解决方案：
• 修改app.py中的端口号
• 或者关闭占用5000端口的程序
```

#### 6. JavaScript错误修复
```
❌ "Cannot set properties of null" 错误

已修复内容：
• 添加了安全的DOM元素检查
• 完善了错误处理机制
• 增加了404/500错误页面
• 添加了favicon避免404请求
```

#### 6. 模板文件缺失
```
❌ TemplateNotFound: 404.html

已修复内容：
• 创建了404.html错误页面
• 创建了500.html错误页面  
• 添加了favicon.ico文件
• 完善了错误处理流程
```

### 技术支持
如果遇到其他问题，请提供：
1. 错误信息截图
2. 浏览器控制台日志
3. 使用的订阅链接（脱敏处理）
4. 操作系统和浏览器版本

## 📂 项目结构
```
clash-web-converter/
├── app.py                 # Flask主应用
├── converter.py           # 转换器核心逻辑
├── requirements.txt       # Python依赖
├── start.bat             # Windows启动脚本
├── README.md             # 项目文档
├── static/               # 静态资源
│   ├── css/
│   │   └── style.css     # 样式文件
│   ├── js/
│   │   └── app.js        # 前端逻辑
│   └── downloads/        # 生成的配置文件
└── templates/
    └── index.html        # 主页面模板
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 开发环境设置
```bash
git clone [项目地址]
cd clash-web-converter
pip install -r requirements.txt
python app.py
```

### 贡献方式
1. Fork本项目
2. 创建功能分支
3. 提交更改
4. 发起Pull Request

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**🎯 让稳定的代理配置触手可得！** 通过现代化的Web界面，让任何人都能轻松转换和管理Clash代理配置。 